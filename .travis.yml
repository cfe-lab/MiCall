language: python
python:
    - "3.6"
before_install:
  - mkdir -p ~/bin
  - export PATH=$PATH:~/bin
  # IVA assembler:
  - sudo apt-get install -y zlib1g-dev libncurses5-dev libncursesw5-dev mummer samtools ncbi-blast+
  - pushd ~/bin
  - wget -q http://sun.aei.polsl.pl/kmc/download-2.1.1/linux/kmc
  - wget -q http://sun.aei.polsl.pl/kmc/download-2.1.1/linux/kmc_dump
  - chmod +x kmc kmc_dump
  - cd ~
  - wget -q http://downloads.sourceforge.net/project/smalt/smalt-0.7.6-bin.tar.gz
  - tar -xzf smalt-0.7.6-bin.tar.gz
  - ln -s ~/smalt-0.7.6-bin/smalt_x86_64 ~/bin/smalt
  # Savage assembler:
  - sudo apt-get install -y zlib1g-dev libboost-timer-dev libboost-program-options-dev libboost-system-dev
  - sudo curl https://sh.rustup.rs -sSf | sh -s -- -y
  - source ~/.cargo/env
  - cargo install --root ~/ --git https://github.com/jeff-k/merge-mates.git
  - cargo install --root ~/ --git https://github.com/jbaaijens/rust-overlaps.git --tag v0.1.1
  - wget -q https://downloads.sourceforge.net/project/bio-bwa/bwa-0.7.17.tar.bz2
  - tar xjf bwa-0.7.17.tar.bz2 --no-same-owner
  - cd bwa-0.7.17
  - make
  - mv bwa ~/bin
  - cd ..
  - wget -q https://github.com/pachterlab/kallisto/releases/download/v0.44.0/kallisto_linux-v0.44.0.tar.gz
  - tar xzf kallisto_linux-v0.44.0.tar.gz --no-same-owner
  - mv kallisto_linux-v0.44.0/kallisto ~/bin
  - git clone https://bitbucket.org/jbaaijens/savage.git
  - cd savage
  - git checkout tags/v0.4.0
  - make
  - echo \#\!/usr/bin/env sh > ~/bin/savage
  - echo python2 ~/savage/savage.py \$@ >> ~/bin/savage
  - chmod +x ~/bin/savage
  - popd

install: "pip install -r requirements-test.txt"
script: "coverage run --source=micall/core,micall/g2p,micall/resistance,micall/monitor -m pytest"

after_success:
    - pip install codecov
    - codecov
