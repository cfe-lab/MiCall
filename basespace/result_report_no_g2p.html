{% comment %}
    
    Simplified result report for MiCall -- do not show g2p results, instead show all 
    coverage plots, not just those for the V3LOOP.
   
{% endcomment %}
<!doctype html>
<html>
<head>
    <title>Results</title>
    <link rel="stylesheet" type="text/css"
        href="https://da1s119xsxmu0.cloudfront.net/libraries/basestrap/1.0.0/css/master.min.css" />
</head>
<body>
    <div class="row-fluid">
        <div class="col-xs-12">
            <h3>Results</h3>
            {% assign bad_tiles = '' %}
            {% for other_result in result.session.results %}
                {% for file in other_result.files.where.ends_with['bad_tiles.csv'] %}
                    {% assign bad_tiles = file.name %}
                {% endfor %}
            {% endfor %}
            {% if bad_tiles == '' %}
                <h3>Warning: Error Rate data not included.</h3>
            {% endif %}
            {% for coverage_file in result.files.where.ends_with['coverage_scores.csv'] %}
                <h4>Quality Control:</h4>
                <table class="table bs-table bs-table-justify">
                    <tr>
                        <th>Sample</th>
                        <th>Project</th>
                        <th>Region</th>
                        <th title="Minimum coverage across key positions">Min</th>
                        <th title="Key position with the minimum coverage">Pos</th>
                        <th title="Overall coverage score (out of 4)">Score</th>
                        <th title="Coverage levels across the region">Coverage Plot</th>
                    </tr>
                    {% for row in result.files[coverage_file].parse.rows %}
                            <tr>
                                <td>{{ row['sample'] }}</td>
                                <td>{{ row['project'] }}</td>
                                <td>{{ row['region'] }}</td>
                                <td>{{ row['min.coverage'] }}</td>
                                <td>{{ row['which.key.pos'] }}</td>
                                <td>{{ row['on.score'] }}</td>
                                {% capture map_file_name %}{{ row['sample'] }}.{{ row['project'] }}.{{ row['region'] }}.png{% endcapture %}
                                <td><img src="{{ result.files.where.ends_with[map_file_name].first.href }}"></td>
                            </tr>
                    {% endfor %}
                </table>
            {% endfor %}
        </div>
    </div>
</body>
</html>

